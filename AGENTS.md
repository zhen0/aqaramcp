# Repository Guidelines

## Project Structure & Module Organization
- Source: `src/`
  - `index.ts`: FastMCP server entry; registers tools, resources, prompts.
  - `aqara-client.ts`: Aqara API client (signing, axios, rate limiting, cache).
  - `utils.ts`: env validation, error formatting, helpers.
  - `types.ts`: shared interfaces and Zod schemas.
- Build output: `build/` (generated by `tsc`). Tests (`**/*.test.ts`) are excluded from the build via `tsconfig.json`.

## Build, Test, and Development Commands
- `npm run dev`: Start live-reload dev server (`tsx watch src/index.ts`).
- `npm run build`: Compile TypeScript to `build/`.
- `npm start`: Run compiled server (`node build/index.js`).
- `npm test`: Run FastMCP in dev against `src/index.ts` for manual tool testing.
- `npm run inspect`: Inspect the MCP interface/metadata via FastMCP.
- `npm run clean`: Remove the `build/` directory.

## Coding Style & Naming Conventions
- TypeScript, ES modules, strict mode enabled; 2-space indentation.
- Filenames: kebab-case for modules (e.g., `aqara-client.ts`); entrypoint `index.ts`.
- Exports: prefer named exports; classes PascalCase; variables/functions camelCase.
- Tool/resource/prompt names use snake_case (e.g., `list_devices`). Use Zod for parameter schemas with clear `describe()` text.

## Testing Guidelines
- No unit test framework is configured. If adding tests, colocate as `*.test.ts` next to sources; they are excluded from the production build.
- Use `npm run inspect` and `npm test` to exercise tools, validate parameters, and inspect outputs.
- Prioritize testing tool execution paths and error handling (e.g., invalid env, API failures).

## Commit & Pull Request Guidelines
- Current history has no formal convention; use Conventional Commits (e.g., `feat: add scene execution`).
- PRs: include summary, motivation, linked issues, and relevant CLI output/screenshots. Keep changes focused and typed; update docs when adding tools/resources.

## Security & Configuration Tips
- Configuration via `.env` (dotenv). Required: `AQARA_APP_ID`, `AQARA_APP_KEY`, `AQARA_KEY_ID`, `AQARA_APP_SECRET`. Optional: `AQARA_REGION` (`cn|usa|eu|kr|ru|sg`), `AQARA_ACCESS_TOKEN`.
- Never commit secrets. Example:
  
  ```env
  AQARA_APP_ID=...
  AQARA_APP_KEY=...
  AQARA_KEY_ID=...
  AQARA_APP_SECRET=...
  AQARA_REGION=usa
  ```

## Agent-Specific Notes
- Validate env early with `validateEnvironment()`.
- Use `formatError` and return JSON-stringified results from tools for consistent responses.
- Respect `AqaraClient` caching and rate limits; call the `clear_cache` tool after state-changing operations when appropriate.

